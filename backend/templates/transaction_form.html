{% extends "base.html" %}

{% block title %}Adicionar Movimento{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto bg-white p-8 rounded-lg shadow-md">
  <h2 class="text-2xl font-bold mb-6 text-blue-700">Adicionar Movimento</h2>

  <div class="mb-8 flex gap-4">
    <button type="button" id="tab-transaction" class="tab-btn bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition font-semibold">Compra</button>
    <button type="button" id="tab-recurring" class="tab-btn bg-gray-200 text-blue-700 px-4 py-2 rounded hover:bg-blue-100 transition font-semibold">Assinatura</button>
  </div>

  <form method="post" class="space-y-6" id="main-form">
    {% csrf_token %}
    <input type="hidden" name="recurring" id="recurring-flag" value="0" />

    <div>
      <label for="account" class="block text-sm font-medium text-gray-700">Conta bancária</label>
      <select name="account" id="account" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 bg-white">
        <option value="" selected disabled>Selecione</option>
        {% for account in accounts %}
          <option value="{{ account.id }}">{{ account.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label for="category" class="block text-sm font-medium text-gray-700">Categoria</label>
      <select name="category" id="category" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 bg-white">
        <option value="" selected disabled>Selecione</option>
        {% for cat in categories %}
          <option value="{{ cat.id }}">{{ cat.name }} ({{ cat.type }})</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label for="description" class="block text-sm font-medium text-gray-700">Descrição</label>
      <input type="text" name="description" id="description" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 bg-white" />
    </div>
    <div class="flex gap-4">
      <div class="flex-1">
        <label for="type" class="block text-sm font-medium text-gray-700">Tipo</label>
        <select name="type" id="type" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 bg-white">
          <option value="" selected disabled>Selecione</option>
          <option value="INCOME">Receita</option>
          <option value="EXPENSE">Despesa</option>
          <option value="TRANSFER">Transferência</option>
        </select>
      </div>
      <div class="flex-1">
        <label for="amount" class="block text-sm font-medium text-gray-700">Valor (R$)</label>
        <input type="number" name="amount" id="amount" step="0.01" min="0" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 bg-white" />
      </div>
    </div>
    <div>
      <label for="date" class="block text-sm font-medium text-gray-700">Data</label>
      <input type="date" name="date" id="date" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 bg-white" />
    </div>
    <div id="transaction-fields">
      <div>
        <label for="status" class="block text-sm font-medium text-gray-700">Status</label>
        <select name="status" id="status" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 bg-white">
          <option value="PLANNED">Planejado</option>
          <option value="CONFIRMED">Confirmado</option>
          <option value="CANCELLED">Cancelado</option>
        </select>
      </div>
    </div>
    <div id="recurring-fields" class="hidden">
      <div>
        <label for="frequency" class="block text-sm font-medium text-gray-700">Frequência</label>
        <select name="frequency" id="frequency" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 bg-white">
          <option value="" selected disabled>Selecione</option>
          <option value="DAILY">Diária</option>
          <option value="WEEKLY">Semanal</option>
          <option value="MONTHLY">Mensal</option>
          <option value="YEARLY">Anual</option>
          <option value="CUSTOM">Personalizada</option>
        </select>
      </div>
      <div class="flex gap-4">
        <div class="flex-1">
          <label for="end_date" class="block text-sm font-medium text-gray-700">Data final (opcional)</label>
          <input type="date" name="end_date" id="end_date" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 bg-white" />
        </div>
      </div>
    </div>
    <div>
      <label for="tags" class="block text-sm font-medium text-gray-700">Tags</label>
      <select name="tags" id="tags" multiple class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 bg-white">
        {% for tag in tags %}
          <option value="{{ tag.id }}">{{ tag.name }}</option>
        {% endfor %}
      </select>
    </div>
    <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-md hover:bg-blue-700 transition text-lg font-semibold">
      Salvar
    </button>
  </form>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const transactionTab = document.getElementById('tab-transaction');
    const recurringTab = document.getElementById('tab-recurring');
    const transactionFields = document.getElementById('transaction-fields');
    const recurringFields = document.getElementById('recurring-fields');
    const recurringFlag = document.getElementById('recurring-flag');

    transactionTab.addEventListener('click', () => {
      transactionTab.classList.add('bg-blue-600', 'text-white');
      transactionTab.classList.remove('bg-gray-200', 'text-blue-700');
      recurringTab.classList.remove('bg-blue-600', 'text-white');
      recurringTab.classList.add('bg-gray-200', 'text-blue-700');
      transactionFields.classList.remove('hidden');
      recurringFields.classList.add('hidden');
      recurringFlag.value = "0";
    });

    recurringTab.addEventListener('click', () => {
      recurringTab.classList.add('bg-blue-600', 'text-white');
      recurringTab.classList.remove('bg-gray-200', 'text-blue-700');
      transactionTab.classList.remove('bg-blue-600', 'text-white');
      transactionTab.classList.add('bg-gray-200', 'text-blue-700');
      recurringFields.classList.remove('hidden');
      transactionFields.classList.add('hidden');
      recurringFlag.value = "1";
    });
  });
</script>
{% endblock %}